---
title: SRE という役割、そしてプロダクトと開発チームへの愛情について (SRE book を読んだ感想から) (仮)
date: 2018-01-13
tags: infra, 雑記
---

## :book: SRE book を読んだ

SRE という肩書で仕事をしはじめて 1 年と半分ほどたち、いつか読もう読もうと思って読んでいなかった [Site Reliability Engineering](https://landing.google.com/sre/book.html)、いわゆる SRE book の日本語訳版を年末年始にかけて読みました。

<div class="amazlet-box" style="margin-bottom:0px;"><div class="amazlet-image" style="float:left;margin:0px 12px 1px 0px;"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873117917" name="amazletlink" target="_blank"><img src="https://images-fe.ssl-images-amazon.com/images/I/51Ybz%2B6kIsL._SL160_.jpg" alt="SRE サイトリライアビリティエンジニアリング ―Googleの信頼性を支えるエンジニアリングチーム" style="border: none;" /></a></div><div class="amazlet-info" style="line-height:120%; margin-bottom: 10px"><div class="amazlet-name" style="margin-bottom:10px;line-height:120%"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873117917" name="amazletlink" target="_blank">SRE サイトリライアビリティエンジニアリング ―Googleの信頼性を支えるエンジニアリングチーム</a><div class="amazlet-powered-date" style="font-size:80%;margin-top:5px;line-height:120%">posted with <a href="http://www.amazlet.com/" title="amazlet" target="_blank">amazlet</a> at 18.01.13</div></div><div class="amazlet-detail"><br />オライリージャパン <br />売り上げランキング: 8,696<br /></div><div class="amazlet-sub-info" style="float: left;"><div class="amazlet-link" style="margin-top: 5px"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873117917" name="amazletlink" target="_blank">Amazon.co.jpで詳細を見る</a></div></div></div><div class="amazlet-footer" style="clear: left"></div></div>

SRE という肩書で業務に取り組んでいる人はもちろん、そうでないインフラエンジニアやサービス開発に取り組んでいるエンジニアの皆さんにも、ぜひオススメしたい一冊です。わたしは最初から最後まで通読しましたが、章ごとに扱っているテーマは分かれているため、興味のある章を拾い読みするのもよいでしょう。一部他の章の知識が必要なところもありますが、そのような章へのリファレンスがキチンとついているので良心的なつくりになっています。

## :bulb: どのような事柄が学べるか

この本がカバーしている内容は非常に広範です。まず「Google における SRE とはなんぞや」というところから始まり、サービスレベル目標、トイルの撲滅、サービス開発チームとの連携の仕方、従来の運用を中心とするチームとの違いといった文化的、マネージメント的な側面から、リリースエンジニアリング、モニタリング、Paxos (とその変種) や Raft などの分散アルゴリズムの概要と分散システムの運用、オンコール、インシデント対応およびカスケーディング障害への対処方法、人を非難しないポストモーテム文化の重要性、データの完全性・可用性の考え方まで、非常に幅広いテーマを扱っています。

## :construction_worker: Google における SRE とは?

従来の運用を中心としたインフラエンジニアの集団ではなく、徹底した自動化と高度なインフラ基盤や開発基盤を作り上げるなど、エンジニアリングを中心にサービスの安定した運用を支えるエンジニア集団です。といっても緊急対応のオペレーションはどうしても発生しますし、サービスのローンチから関わる場合にはアプリケーションのコードを書くこともあります。

## :rabbit: SRE book とわたし自身の経験を照らし合わせて考えたこと

ここからは、SRE book に書かれていることと、わたし自身の経験に照らし合わせて、考えたことや想いをつらつらと書き綴っていきます。

チームや組織の在り方によってベストプラクティスは変わってくるので、本の中で出てくるすべての事柄がわたしの所属するチームに適用できるというわけではありません。しかしながら、その内容は新たな気付きに富むものでした。

### 50% の時間をエンジニアリングにあてる

興味深いのは、Google の SRE の基準では就業時間の最低 50% はエンジニアリングにあてるように、日々仕事に取り組んでいるそうです。

「50%? 思ったより少ない..? わたしももっとやってる気がするし、天下の Google のエンジニアならなおさら..」

というのが、わたしの最初のナイーブな感覚でした。

この感覚が正しいのかどうかを確かめるために、試しに新年明けてからの業務において、「これはエンジニアリング」「これはエンジニアリングではない」というように、進めている作業をハッキリと分類して意識するようにし、日報に書いていくようにしました。

その結果、一日あたり 50% 以上エンジニアリングに充てられたと確信できた日数が、そうでない日数よりも少ないことに気づきました。**思っていたよりもエンジニアリングにあてている時間が少なかったのです**。

SRE book では **トイル** という概念が紹介されており、以下のような特徴を持つタスクである、とされています。

- 運用に関係する作業である
- 手作業で繰り返し行われる
- 自動化できる余地が十分にある
- 長期的な価値をもたらすものではない
- 作業量がサービスの成長とともに比例して増えていく

トイルを放置していると、サービスの成長とともに人員の数を増やさざるを得なくなり、それにはいつか限界がきます。チームがスケールしなければ、トイルをこなすことに追われてしまい、人間が必要な知的で本当に価値のある仕事をすることができません。

先ほど思ったよりエンジニアリングができていないことに気づいたと書きましたが、わたしも例外ではなく、意識していなかっただけでトイルは確実に存在していて、思っていたよりも時間を奪われていたのでした。

### 開発チームと対等な関係で緊密に連携するということ

Google では**エラーバジェット**という考え方で開発チームとの対等な関係を維持しているそうです。エラーバジェットとは、`1 - あるサービスの SLO (サービスレベル目標)` で表される数値です。もし SLO が 99.99% ならば、エラーバジェットは 0.01% ということになります。

エラーバジェットとは、すなわちどの程度エラーやインシデントによる計画されていないメンテナンスを許容するかということです。エラーバジェットが残っている限り、開発チームは新しい機能をリリースしてよく、もしエラーバジェットが尽きてしまったら、新しい機能のリリースは禁止となり、システムを安定化させることに注力することになります。

ここで興味深いのは、エラーバジェットによる対等な関係を築いていることはもとより、開発チームの一部のメンバーもサービスのオンコールローテーションに加わることがある、ということです。エラーバジェットが尽きた際には、場合によってはページャを開発チームに返すこともあるそうです。

わたしの所属している SRE チームでは、プロダクション環境は原則として SRE チームがすべて預かっている状態です。わたしが現 SRE チームに加わった当時からそのような体勢であったため、そもそも開発チームがオンコールに加わるという発想が、とても新鮮に感じられました。開発チームのメンバーがオンコールに加わることで、サービス開発者の運用面への意識が高まるという効果もあるそうです。反対に、SRE がアプリケーションコードの改修やアーキテクチャの再構築によってパフォーマンスを改善する、というようなことも積極的に行われているそうです。
